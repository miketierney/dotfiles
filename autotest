require 'autotest-growl'
require 'autotest-fsevent'
require 'redgreen/autotest' unless ENV['RSPEC']

# Autotest::Growl::clear_terminal = false
Autotest::Growl::show_modified_files = true
Autotest::Growl::remote_notification = true
# Autotest::Growl::image_dir = File.join(ENV['HOME'], 'Pictures/autotest')

Autotest.add_hook :initialize do |autotest|
  autotest.sleep = 1
  %w{.git .svn .hg .DS_Store ._* vendor}.each {|exception| autotest.add_exception(exception) }
  
  unless ARGV.empty?
    if File.exist? 'config/environment.rb'
      autotest.find_directories = ARGV.length == 1 ? ["spec/#{ARGV.first}", "app/#{ARGV.first}"] : ARGV.dup
    end
  end
  
  autotest.add_mapping(%r%^spec/(processors|mailers|middlewares)/.*rb$%) { |filename, _| filename}
end

# module AutotestMac
#   GROWLNOTIFY = "/opt/local/bin/growlnotify"
#   GEM_DIR = '/Users/mike/Pictures/autotest'
#   module Autotest::Growl
#     
#     ##
#     # Display a message through Growl.
#     def self.growl title, message, color, priority=0, stick=""
#       case color
#       when "red"
#         priority = 2
#         image = "glornak"
#       when "yellow"
#         priority = 1
#         image = "arthur"
#       when "green"
#         priority = -1
#         image = "flaco"
#       else
#         # TODO: Need a better neutral state icon.
#         priority = 0
#         image = "arthur"
#       end
#       
#       icon = "#{GEM_DIR}/#{image}.png"
#       system "#{GROWLNOTIFY} -H localhost -n autotest --image '#{icon}' -p #{priority} -m #{message.inspect} '#{title}' #{stick}"
#     end
#   end
# end